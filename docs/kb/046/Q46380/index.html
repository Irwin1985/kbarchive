<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q46380: -P1 One-Pass Assembly Can Result in A2006 Phase Error | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q46380: -P1 One-Pass Assembly Can Result in A2006 Phase Error" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/046/Q46380/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/046/Q46380/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q46380: -P1 One-Pass Assembly Can Result in A2006 Phase Error","url":"http://jeffpar.github.io/kbarchive/kb/046/Q46380/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q46380--p1-one-pass-assembly-can-result-in-a2006-phase-error">Q46380: -P1 One-Pass Assembly Can Result in A2006 Phase Error</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q46380
Product(s): See article
Version(s): 2.01
Operating System(s): MS-DOS
Keyword(s): ENDUSER | buglist2.01 | mspl13_masm
Last Modified: 26-JUL-1989

A phase error message is generated by the QuickAssembler Version 2.01
if the -P1 one pass assembly option is chosen and the following
scenario is fulfilled:

1. On any binary arithmetic instruction (AND, ADD, OR, CMP, SUB, XOR,
   SBB, ADC) where the first operand contains a forward reference to a
   WORD data label

2. The second operand is a nonforward referenced symbolic immediate
   whose value could be represented in a sign-extended byte (i.e.,
   007fh, 0ff84h, -1, 12, but not 0081h since it sign-extends to
   0ff81h)

Any of the following actions will resolve this error:

1. Use -P2.

2. Define the data label before the point of reference.

3. Use a BYTE PTR type cast operation on the immediate symbol (i.e.,
   "cmp foo, byte ptr bar").

Microsoft has confirmed this to be a problem in QuickAssembler Version
2.01. We are researching this problem and will post new information as
it becomes available.

The following example will reproduce this problem:

TRUE            equ     1               ; Boolean True value
CSEG    SEGMENT PARA PUBLIC 'CODE'
        ASSUME  CS:CSEG,DS:CSEG,SS:CSEG ; Already set by DOS loader (COM File
        ASSUME  CS:CSEG,SS:CSEG         ; Already set by DOS loader (COM File

        org     100h
entry:                                  ; Program entry point
queueScreen proc near                   ; Procedure declaration
        cmp     cs:screenQueued,TRUE    ; screenQueued is forward referenced.
        ret
queueScreen endp

screenQueued    dw      0

CSEG    ENDS
        END     entry

to resolve the phase error in this specific example, do one of the
following:

1. Select -P2, the two-pass assembly option.

2. Change the following line

      cmp     cs:screenQueued, TRUE

   to the following:

      cmp     cs:screenQueued, byte ptr TRUE

3. Move the definition of screenQueued so that it is defined prior to
   the compare instruction, for example:

                screenQueued    dw      0
                .
                .
                .
                cmp     cs:screenQueued, TRUE

Any of these solutions will work around this phase error problem in
this specific example. These solutions prevent many phase errors from
occurring when assembling similar kinds of data references with either
QuickAssembler or MASM since the source of phase errors is usually due
to the assembler making an incorrect assumption about the type of a
variable that is referred to before it is defined.
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>