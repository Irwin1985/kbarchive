<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q221648: FIX: RI Code Not Selecting Right Work Area After Cascaded Delete | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q221648: FIX: RI Code Not Selecting Right Work Area After Cascaded Delete" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/221/Q221648/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/221/Q221648/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q221648: FIX: RI Code Not Selecting Right Work Area After Cascaded Delete","url":"http://jeffpar.github.io/kbarchive/kb/221/Q221648/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q221648-fix-ri-code-not-selecting-right-work-area-after-cascaded-delete">Q221648: FIX: RI Code Not Selecting Right Work Area After Cascaded Delete</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q221648
Product(s): Microsoft FoxPro
Version(s): WINDOWS:5.0,5.0a,6.0
Operating System(s): 
Keyword(s): kbDatabase kbvfp600 kbvfp600bug KbDBFDBC kbVS600sp3fix kbGrpDSFox kbDSupport kbCodeSnip
Last Modified: 02-SEP-1999

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Visual FoxPro for Windows, versions 5.0, 5.0a, 6.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

You have a database container (DBC) that contains several tables. The DBC
contains referential integrity code generated by the Referential Integrity (RI)
Builder. The RI is configured to cascade deletes from a parent to a child table,
and from the child table to another child table. When a record is deleted from
the parent table, the stored procedure that performs the cascaded delete does
not immediately reselect the correct work area after the delete occurs.

CAUSE
=====

In the code created by the Referential Integrity Builder, the local variable
lcStartArea is declared in both the insert and update code, but not in the
delete code.

STATUS
======

Microsoft has confirmed this to be a bug in the Microsoft products listed at the
beginning of this article.

This bug was corrected in Visual Studio 6.0 Service Pack 3.

For more information about Visual Studio service packs, please see the following
articles in the Microsoft Knowledge Base:

  Q194022 INFO: Visual Studio 6.0 Service Packs, What, Where, Why

  Q194295 HOWTO: Tell That Visual Studio 6.0 Service Packs Are Installed

MORE INFORMATION
================

Steps to Reproduce Behavior
---------------------------

1. Run the following code from a program (.PRG) file:

  #DEFINE CRLF CHR(13)+CHR(10)

  CLOSE DATA ALL
  * Make the DBC
  CREATE DATABASE 'RITEST.DBC'

  * Add the stored procedures. Because STRTOFILE() was not available in
  * VFP 5, you will have to create this stored procedure manually
  STRTOFILE("PROC RITestProc"+CRLF+ ;
     "   messagebox([Current work area is ]+str(select()))"+CRLF +;
     "ENDPROC", 'procs.txt')

  APPEND PROC FROM 'procs.txt' OVERWRITE
  DELETE FILE procs.txt

  * Make the tables, indexes, relations, and trigger
  CREATE TABLE 'RITBL1.DBF' NAME 'RITBL1' (FLD1 C(10) NOT NULL ;
     PRIMARY KEY, FLD2 C(25) NOT NULL)
  CREATE TRIGGER ON 'RITBL1' FOR DELETE AS RITestProc()

  CREATE TABLE 'RITBL2.DBF' NAME 'RITBL2' (FLD1 C(10) NOT NULL, ;
     FLD2 D NOT NULL PRIMARY KEY)
  ALTER TABLE 'RITBL2' ADD FOREIGN KEY FLD1 TAG FLD11 ;
     REFERENCES RITBL1 TAG FLD1

  CREATE TABLE 'RITBL3.DBF' NAME 'RITBL3' (FLD2 D NOT NULL, ;
     FLD3 C(25) NOT NULL)
  ALTER TABLE 'RITBL3' ADD FOREIGN KEY FLD2 TAG FLD2_3 ;
     REFERENCES RITBL2 TAG FLD2

  * Add the data
  INSERT INTO RITBL1 VALUES('1', 'One')
  INSERT INTO RITBL2 VALUES('1', DATE())
  INSERT INTO ritbl3 VALUES(DATE(), "Today")

  * Open the Database Designer to run RI builder
  MODIFY DATABASE

  * Delete the record in RITBL1 to demonstrate behavior
  USE RITBL1 IN 1
  DELETE FROM RITBL1 WHERE FLD1=='1'

2. When the Database Designer is displayed, right-click on the Database
  Designer, and select Edit Referential Integrity from the Context menu.

3. When the Referential Integrity Builder is displayed, click the Rules for
  Deleting tab. Select the first record in the grid, and click the Cascade
  option.

4. Select the second record in the grid, and click the Cascade option, then
  click OK. If performed properly, the Delete column for both of the grid's
  records contain the word "Cascade."

5. Click Yes in each of the two warning dialogs that appear.

6. Close the Database Designer.

The messagebox appears, showing that the current work area is 2.
(c) Microsoft Corporation 1999, All Rights Reserved. Contributions by Jim
Saunders, Microsoft Corporation.


Additional query words:

======================================================================
Keywords          : kbDatabase kbvfp600 kbvfp600bug KbDBFDBC kbVS600sp3fix kbGrpDSFox kbDSupport kbCodeSnippet 
Technology        : kbVFPsearch kbAudDeveloper kbVFP500 kbVFP600 kbVFP500a
Version           : WINDOWS:5.0,5.0a,6.0
Issue type        : kbbug
Solution Type     : kbfix

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>