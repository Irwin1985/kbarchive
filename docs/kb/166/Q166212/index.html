<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q166212: INFO: ProcessMessageFilter gets called only for messages posted | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q166212: INFO: ProcessMessageFilter gets called only for messages posted" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/166/Q166212/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/166/Q166212/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q166212: INFO: ProcessMessageFilter gets called only for messages posted","url":"http://jeffpar.github.io/kbarchive/kb/166/Q166212/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q166212-info-processmessagefilter-gets-called-only-for-messages-posted">Q166212: INFO: ProcessMessageFilter gets called only for messages posted</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q166212
Product(s): Microsoft C Compiler
Version(s): winnt:2.0,2.1,2.2,4.0,4.0a,4.1,4.2,4.2b,5.0,6.0
Operating System(s): 
Keyword(s): kbcode kbnokeyword kbHook kbMFC kbVC kbVC152 kbVC200 kbVC210 kbVC220 kbVC400 kbVC410 kb
Last Modified: 04-AUG-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- The Microsoft Foundation Classes (MFC), used with:
   - Microsoft Visual C++ for Windows, 16-bit edition, version 1.52 
   - Microsoft Visual C++, 32-bit Editions, versions 2.0, 2.1, 2.2, 4.0, 4.0a, 4.1 
   - Microsoft Visual C++, 32-bit Enterprise Edition, version 4.2 
   - Microsoft Visual C++, 32-bit Professional Edition, version 4.2 
   - Microsoft Visual C++, 32-bit Enterprise Edition, version 4.2b 
   - Microsoft Visual C++, 32-bit Professional Edition, version 4.2b 
   - Microsoft Visual C++, 32-bit Enterprise Edition, version 5.0 
   - Microsoft Visual C++, 32-bit Professional Edition, version 5.0 
   - Microsoft Visual C++, 32-bit Enterprise Edition, version 6.0 
   - Microsoft Visual C++, 32-bit Professional Edition, version 6.0 
   - Microsoft Visual C++, 32-bit Learning Edition, version 6.0 
-------------------------------------------------------------------------------

SUMMARY
=======

ProcessMessageFilter is only called for messages that are posted to the message
queue and is not called for messages that are send directly to the window
procedure. Therefore, this function cannot be used to monitor messages that are
sent (by "Windows" or by the user) to a dialog box, message box, menu, or a
scroll bar.

ProcessMessageFilter is called from _AfxMsgFilterHook, which is the MFC hook
procedure for WH_MSGFILTER hook. This hook procedure will be called by the
system after a message generated by an input event (in a dialog box, message
box, menu, or scroll bar) is retrieved from the message queue. Since messages
sent directly to the window procedure (by SendMessage) do not go through the
message queue, this hook procedure is not called by Windows. This in turn blocks
the call to ProcessMessageFilter.

MORE INFORMATION
================

The WH_MSGFILTER hook is a task-specific hook that enables an application to
monitor messages passed to a menu, scroll bar, message box, or dialog box
created by the application that installed the hook procedure. In a typical MFC
application the WH_MSGFILTER is set in the global function AfxWinInit(), and in
_AfxThreadEntry for multithreaded applications, with _AfxMsgFilterHook as the
callback or the hook procedure.

The callback function for this hook is called after these messages are retrieved
from the queue, just before dispatching them, performing special processing as
appropriate. Since messages sent directly to the window procedure (by
SendMessage) do not go through the message queue, the hook procedure
(_AfxMsgFilterHook) is not called by Windows.

ProcessMessageFilter of CWinThread (in MFC 3.x and up) and CWinApp (in MFC 2.x)
is called from the _AfxMsgFilterHook hook procedure. Since the hook procedure
will not be called for messages sent directly to the window procedure,
ProcessMessageFilter will not get called and none of the special code inside
will execute.

In general, all the keyboard and mouse messages, along with the WM_PAINT and
WM_TIMER messages, are posted to the message queue. ProcessMessageFilter will
not be called for messages like WM_SETFOCUS, WM_KILLFOCUS, WM_SETCURSOR,
WM_COMMAND, WM_CTLCOLOR, WM_ACTIVATE, etc., since these are sent directly to the
window procedure.

To monitor messages that are sent to a menu, message box, dialog box or a scroll
bar, set a WH_CALLWNDPROC hook. This hook is called whenever a message is sent
directly to a window procedure. Note that there will be a tradeoff with
performance since this hook procedure is called for every message that are sent
through SendMessage.

REFERENCES
==========

Additional information on SetWindowsHookEx, MessageProc, WH_MSGFILTER can be
found in the Windows API documentation.

Additional query words:

======================================================================
Keywords          : kbcode kbnokeyword kbHook kbMFC kbVC kbVC152 kbVC200 kbVC210 kbVC220 kbVC400 kbVC410 kbVC420 kbVC500 kbVC600 kbVS600 kbGrpDSMFCATL 
Technology        : kbAudDeveloper kbMFC
Version           : winnt:2.0,2.1,2.2,4.0,4.0a,4.1,4.2,4.2b,5.0,6.0
Issue type        : kbinfo

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>