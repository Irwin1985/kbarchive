<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q155703: PRB: MCI Fails to Read a File Using a Custom mmio Procedure | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q155703: PRB: MCI Fails to Read a File Using a Custom mmio Procedure" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/155/Q155703/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/155/Q155703/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q155703: PRB: MCI Fails to Read a File Using a Custom mmio Procedure","url":"http://jeffpar.github.io/kbarchive/kb/155/Q155703/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q155703-prb-mci-fails-to-read-a-file-using-a-custom-mmio-procedure">Q155703: PRB: MCI Fails to Read a File Using a Custom mmio Procedure</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q155703
Product(s): Microsoft Windows Software Development Kit
Version(s): WINDOWS:4.0
Operating System(s): 
Keyword(s): kbmm
Last Modified: 04-FEB-2000

4.00
WINDOWS
kbprg kbprb

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Windows Software Development Kit (SDK) 4.0 
- Microsoft Visual C++, version 4.1 
-------------------------------------------------------------------------------

SYMPTOMS
========

On the Windows 95 platform, the Media Control Interface (MCI) returns
MMSYSTEM348 error when using a custom mmio procedure to read a wave or an avi
file (device element). The text description for MMSYSTEM348 is "Cannot read this
file. Make sure the file hasn't been deleted, or check your disk or network
connection."

CAUSE
=====

The value in the adwInfo[2] member of the MMIOINFO structure is used by MCIWAVE
and MCIAVI drivers. Therefore, its content cannot be trusted when the custom
mmio procedure is invoked to read the custom device element. The stated problem
occurs when a custom mmio procedure uses adwInfo[2] to store the pointer to the
data to be read.

RESOLUTION
==========

A simple workaround is to use a static local variable to retain information
between invocations of the custom procedure. For instance:

  static DWORD dwMyLocalVar;

MORE INFORMATION
================

MCI allows the use of a custom mmio procedure to open a wave or an avi device.
When the custom procedure is invoked, the first argument is a pointer to
MMIOINFO structure. One field in MMIOINFO is adwInfo. In general, a custom mmio
procedure can use adwInfo for state information. However, if the custom
procedure is to be used by MCI drivers, it should use other local variables to
store information. Please note that this problem only occurs for 32-bit
applications running on Windows 95 operating system.

Additional query words: 4.00 kbdsd wave audio avi video mmioInstallIOProc

======================================================================
Keywords          : kbmm 
Technology        : kbVCsearch kbWinNT400xsearch kbAudDeveloper kbSDKSearch kbVC410 kbWinSDKSearch kbWinSDK400
Version           : WINDOWS:4.0

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>