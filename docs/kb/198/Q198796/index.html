<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q198796: IAS Cannot Authenticate to Windows NT Domain Using CHAP | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q198796: IAS Cannot Authenticate to Windows NT Domain Using CHAP" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/198/Q198796/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/198/Q198796/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q198796: IAS Cannot Authenticate to Windows NT Domain Using CHAP","url":"http://jeffpar.github.io/kbarchive/kb/198/Q198796/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q198796-ias-cannot-authenticate-to-windows-nt-domain-using-chap">Q198796: IAS Cannot Authenticate to Windows NT Domain Using CHAP</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q198796
Product(s): Microsoft Windows NT
Version(s): winnt:4.0
Operating System(s): 
Keyword(s): 
Last Modified: 11-JUN-2002

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Windows NT Server version 4.0 
-------------------------------------------------------------------------------

IMPORTANT: This article contains information about modifying the registry. Before you modify the registry, make sure to back it up and make sure that you understand how to restore the registry if a problem occurs. For information about how to back up, restore, and edit the registry, click the following article number to view the article in the Microsoft Knowledge Base:

  Q256986 Description of the Microsoft Windows Registry

SYMPTOMS
========

When you are authenticated by a Windows NT domain using Microsoft Internet
Authentication Service (IAS), you cannot be authenticated using Challenge
Handshake Authentication Protocol (CHAP).

CAUSE
=====

This behavior occurs because the CHAP specification requires passwords to be
stored in "reversibly encrypted format" or in plain-text format.

Computers running Windows NT Server store user information in a database called
the Security Accounts Manager (SAM). The user passwords stored in the SAM cannot
be compromised, even if the internal file structures are discovered. A user in a
domain that uses CHAP creates a challenge response by combining the challenge
sent by the Network Access Server (NAS) and the user's plain-text password.
Windows NT domain controllers cannot reproduce the plain-text password from the
value stored in the SAM database, and IAS cannot authenticate a CHAP request.

For additional information, please refer to the following Request for Comments
(RFC) document: RFC 1994, section 2.2. For information about obtaining RFC
documents from the Internet, please see the following article in the Microsoft
Knowledge Base:

  Q185262 How to Obtain Request for Comments Documents from the Internet

RESOLUTION
==========

WARNING: If you use Registry Editor incorrectly, you may cause serious problems
that may require you to reinstall your operating system. Microsoft cannot
guarantee that you can solve problems that result from using Registry Editor
incorrectly. Use Registry Editor at your own risk.

To work around this problem, use the appropriate method:

- Use Microsoft CHAP instead of CHAP.

Microsoft CHAP is an updated version of CHAP. It does not require that passwords
be stored in reversibly encrypted or plain text format. To use Microsoft CHAP,
your NAS hardware manufacturer must support it and Microsoft CHAP must be
configured on your hardware. If your current hardware does not support Microsoft
CHAP, please check with your hardware manufacturer for a firmware update that
adds support for Microsoft CHAP authentication. If you are using Windows NT with
Routing and Remote Access Service (RRAS) as your NAS device, you can enable
Microsoft CHAP support.

For additional information, please see the following article in the Microsoft
Knowledge Base:

  Q219283 Using MS-CHAP with Radius Authentication

You can also refer to the following RFC for further information:

  http://www.ietf.cnri.reston.va.us/rfc/rfc2433.txt

The third-party contact information included in this article is provided to help
you find the technical support you need. This contact information is subject to
change without notice. Microsoft in no way guarantees the accuracy of this
third-party contact information.

- Use PAP or SPAP.

Password Authentication Protocol (PAP) sends passwords in plain text between the
remote client and the NAS computer. In most cases, this communication happens
over a dial-up phone line. When the request reaches the NAS computer, the
password is sent to the Microsoft Radius server using RSA-MD5 encryption.
Although PAP is used by numerous Internet service providers, it is the least
preferred method. Shiva Password Authentication Protocol (SPAP), CHAP, or
Microsoft CHAP is preferred for security reasons. If you are using Windows NT
with RRAS as your NAS device, you can enable PAP support.

For additional information, please see the following article in the Microsoft
Knowledge Base:

  Q172216 How to Force Routing and Remote Access to Use PAP

SPAP is a Shiva proprietary standard but it can be used on other NAS hardware.
SPAP is preferable to PAP, but it is not as secure as Microsoft CHAP.

- Apply the CHAP fix to all Windows NT 4.0 domain controllers.

Microsoft has a fix for Windows NT 4.0 domain controllers to support CHAP. Before
you install CHAP support on any domain controller, create an Emergency Repair
Disk (ERD) for the domain controller. You can use the ERD to recover the server
in the event of a problem with the CHAP support software.

NOTE: You must install this software on both primary and backup domain
controllers so that authentication still operates even if the primary domain
controller is offline for any reason.

To apply the IAS security fix on domain controllers:

  1. Install the fix using the Iaspack.exe tool included with the fix.

  2. Run Regedt32.

  3. On the Window menu, click "HKEY_LOCAL_MACHINE on Local Machine".

  4. Find the System\CurrentControlSet\Control\Lsa\MD5-CHAP key, and then
     double-click the Store Clear Text Passwords value.

  5. In the DWORD Editor dialog box, change the data value from 0 to 1. Click
     OK. Note that the REG_DWORD value is displayed as 0x1.

  6. Quit Registry Editor.

  7. Restart the domain controller.

Important Note About Windows NT and CHAP Support
------------------------------------------------

The following limitations are inherent when you implement CHAP on a server. Most
occur because CHAP traps password changes to store them in the SAM.

- CHAP authentication does not go into effect until the domain controller is
  upgraded and users have changed their password. Users must change their
  password to store the reversibly encrypted passwords in the SAM database. If
  you are currently using a Beta version of the Microsoft CHAP software, users
  with a reversibly encrypted password do not have to change their password
  with this fix.

- Domain controllers that have CHAP support require about 100 bytes more RAM
  per user in the database.

- Because of the decrease in performance involved and additional steps required
  to configure this fix, Microsoft recommends using one of the other protocols
  mentioned above.

  For additional information about how to get this fix from Microsoft Product
  Support Services, click the article number below to view the article in the
  Microsoft Knowledge Base:

  Q197506 IAS Incorrectly Validates User Accounts

  NOTE: SP6 is NOT required to install this fix; it may be installed on a
  computer running Windows NT 4.0 SP4, SP5, or SP6. This fix should be applied
  after you install or reinstall any service pack.

STATUS
======

Microsoft has confirmed this to be a problem in the Microsoft products that are
listed at the beginning of this article.

Additional query words: MS-CHAP

======================================================================
Keywords          :  
Technology        : kbWinNTsearch kbWinNT400search kbWinNTSsearch kbWinNTS400search kbWinNTS400
Version           : winnt:4.0
Issue type        : kbprb
Solution Type     : kbpending

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>