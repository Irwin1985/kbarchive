<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q73036: BUG: Macro Expansion May Occur Before Macro Call in Listing File | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q73036: BUG: Macro Expansion May Occur Before Macro Call in Listing File" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/073/Q73036/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/073/Q73036/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q73036: BUG: Macro Expansion May Occur Before Macro Call in Listing File","url":"http://jeffpar.github.io/kbarchive/kb/073/Q73036/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q73036-bug-macro-expansion-may-occur-before-macro-call-in-listing-file">Q73036: BUG: Macro Expansion May Occur Before Macro Call in Listing File</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q73036
Product(s): Microsoft Macro Assembler
Version(s): MS-DOS:6.0,6.0a,6.0b,6.1,6.11,6.1a
Operating System(s): 
Keyword(s): 
Last Modified: 06-MAY-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Macro Assembler (MASM), versions 6.0, 6.0a, 6.0b, 6.1, 6.1a, 6.11 
-------------------------------------------------------------------------------

SYMPTOMS
========

With the Microsoft Macro Assembler (MASM), if the .NOLIST directive is the first
statement in a file and it is later followed by a .LISTALL directive, then the
macro expansion in the listing file will occur before the macro call instead of
after it.

RESOLUTION
==========

This problem can be eliminated by placing either a blank line or a comment
before the .NOLIST directive, so that .NOLIST is not on the first line of the
file.

STATUS
======

Microsoft has confirmed this to be a problem in MASM version 6.0, 6.0a, 6.0b,
6.1, 6.1a, and 6.11. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.

MORE INFORMATION
================

The .NOLIST directive prevents the macro expansion of all macro calls in the
listing file. This option shows the macro call, but it does not display the
corresponding code. The .NOLIST directive also prevents a complete listing of
every macro in each file that is included with the .INCLUDE directive. The
.LISTALL directive lists all source lines, including false conditionals and
generated code for each macro.

In the sample code below, the placement of the .NOLIST directive before the
.INCLUDE directive prevents a general listing of every macro in that include
file. Placing the .LISTALL after the .INCLUDE directive should cause the
corresponding code for each macro to be listed after that macro appears in the
source code. For example, the correct listing for TEST_MACRO should appear as
follows:

                 TEST_MACRO
  0000  55              1       PUSH  BP
  0001  8B EC           1       MOV   BP, SP

However, if .NOLIST is the first statement on the first line in the file, then
this order is reversed and the macro expansion appears before the macro call.
The incorrect macro expansion actually appears as follows:

  0000  55              1       PUSH  BP
  0001  8B EC           1       MOV   BP, SP
                 TEST_MACRO

Sample Code
-----------

TEST.ASM
--------

  ; Assemble options needed: /Fl

  .NOLIST
  INCLUDE test.inc
  .LISTALL

  .MODEL small
  .STACK 4096

  .CODE
  start:
     test_macro
     mov ax, 4C00h
     int 21h
  END start

TEST.INC
--------

  ; Include file for TEST.ASM

  test_macro MACRO
     push bp
     mov bp, sp
  ENDM

Additional query words: 6.00 6.00a 6.00b 6.10 6.10a buglist6.00a buglist6.00b buglist6.10 buglist6.10a buglist6.11

======================================================================
Keywords          :  
Technology        : kbMASMsearch kbAudDeveloper kbMASM600 kbMASM610 kbMASM611 kbMASM610a kbMASM600a kbMASM600b
Version           : MS-DOS:6.0,6.0a,6.0b,6.1,6.11,6.1a

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>