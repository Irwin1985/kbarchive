<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q50341: Preprocessor Condenses Multi-Line Macro Invocations | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q50341: Preprocessor Condenses Multi-Line Macro Invocations" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/050/Q50341/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/050/Q50341/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q50341: Preprocessor Condenses Multi-Line Macro Invocations","url":"http://jeffpar.github.io/kbarchive/kb/050/Q50341/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q50341-preprocessor-condenses-multi-line-macro-invocations">Q50341: Preprocessor Condenses Multi-Line Macro Invocations</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q50341
Product(s): See article
Version(s): 5.00 5.10 | 5.10
Operating System(s): MS-DOS | OS/2
Keyword(s): ENDUSER | | mspl13_c
Last Modified: 17-JUL-1990

The preprocessor of the Microsoft C Optimizing Compiler versions 5.00
and 5.10 does not preserve the source code structure of macro
invocations upon expansion. Preprocessor macro expansion is carried
out on one line at a time, in a left to right fashion, until the
end-of-line is reached. Thus, when multiple-line macro invocations are
expanded, they are converted into a single line of code.

The following example defines a simple macro and displays this
conversion of multi-line macro invocations:

#define macro( arg1, arg2, arg3 ) arg1 + arg2 + arg3

     Source Code           Preprocessor Listing
    _____________          ____________________

  value = macro ( param1,  value = macro( param1 + param2 + param3 );
                  param2,
                  param3 );

Note that the preprocessor listing replaces the three lines of code
in the source file with only one line. As a result, the line numbers
between the two files are different because the preprocessor does not
perform any line number adjustment.

This may cause problems if one must compile preprocessor listings to
avoid errors generated by .C source files (i.e., insufficient heap
space). When the preprocessor listing is compiled, the subtle side
effect becomes more obvious in the form of discrepancies between
original source-code line numbers and line numbers associated with
compiler errors or debugger maps. This result can make debugging
original source code difficult and can be a general nuisance when
trying to locate erroneous lines in source code indicated by the
compiler.

The #line directive and the __LINE__ predefined macro can be used to
redefine preprocessor listing line numbers and eliminate such
differences. To compensate for the preprocessor single-line expansion
of macro invocations, place the directive "#line __LINE__" in the
source code line following the macro invocation.

The #line directive, which accepts an integer constant as an argument,
instructs the preprocessor to change the compiler's internally stored
line number to the integer argument specified. The __LINE__ macro,
which is supplied as the argument to the #line directive, evaluates to
the current line number generated during preprocessing. Working
together, they force the compiler to generate consistent line numbers
between the the source file and the preprocessor listing.

The program below illustrates the macro expansion behavior of the C
preprocessor and how it can be modified to generate
line-number-compatible source and preprocessor listings.

          /* TEST.C */           |          /* TEST.I */
                                 |
/*1*/  #define sum( a,b,c) a+b+c | /*1*/  #define sum(a,b,c) a+b+c
/*2*/                            | /*2*/
/*3*/  void main( void )         | /*3*/    void main( void )
/*4*/  {                         | /*4*/    {
/*5*/     int i;                 | /*5*/   int i;
/*6*/     i =  sum( 1,           | /*6*/   i =  sum( 1, 2, 3 );
/*7*/           2,               | /*7*/   /*  #line __LINE__    */
/*8*/           3 );             | /*8*/   i = 100000;
/*9*/     /*  #line __LINE__  */ | /*9*/    }
/*10*/    i = 100000;            | /*10*/
/*11*/ }                         | /*11*/
                                 |

When the program, TEST.C, above is compiled under warning level three,
a data conversion warning is generated for line 10, indicating
overflow of the integer variable i. TEST.C is then run through the
preprocessor using the /P compiler option, where TEST.I (above) is
generated. Compiling TEST.I under warning level three generates the
same data conversion warning, but on line 8. The line number
difference between TEST.C and TEST.I is quite obvious.

By uncommenting line 9 in the TEST.C, both the source file and
preprocessor listing contain consistent line numbers following the
macro invocation because the line number is reset to the proper value
(seven) after the preprocessor pass.
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>