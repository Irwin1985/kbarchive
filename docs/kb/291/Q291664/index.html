<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q291664: HOWTO: Detect Safe Mode Startup with Visual Basic | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q291664: HOWTO: Detect Safe Mode Startup with Visual Basic" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/291/Q291664/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/291/Q291664/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q291664: HOWTO: Detect Safe Mode Startup with Visual Basic","url":"http://jeffpar.github.io/kbarchive/kb/291/Q291664/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q291664-howto-detect-safe-mode-startup-with-visual-basic">Q291664: HOWTO: Detect Safe Mode Startup with Visual Basic</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q291664
Product(s): Microsoft Visual Basic for Windows
Version(s): 5.0,6.0
Operating System(s): 
Keyword(s): kbAPI kbSDKWin32 kbVBp kbVBp500 kbVBp600 kbGrpDSVB kbDSupport
Last Modified: 12-APR-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Visual Basic Enterprise Edition for Windows, versions 5.0, 6.0 
- Microsoft Visual Basic Professional Edition for Windows, versions 5.0, 6.0 
-------------------------------------------------------------------------------

SUMMARY
=======

For some applications, it may be useful to detect if the local system was
started in Safe Mode in order to run appropriately in this mode or to avoid
running in Safe Mode. This article describes how to use a Win32 application
programming interface (API) to determine the startup mode of the local system.

MORE INFORMATION
================

You can use the GetSystemMetrics function with the SM_CLEANBOOT index specified
to detect the startup mode of the system. The SM_CLEANBOOT index returns one of
three values, based on how the system was started:

+------------------------------------------+
| Return Value | Meaning                   | 
+------------------------------------------+
| 0            | Normal Boot               | 
+------------------------------------------+
| 1            | Safe Mode                 | 
+------------------------------------------+
| 2            | Safe Mode with Networking | 
+------------------------------------------+

Step-by-Step Example
--------------------

The following Visual Basic code demonstrates how to detect Safe Mode:

1. Start a new Visual Basic standard EXE project. Form1 is created by default.

2. Add a new command button (Command1) to Form1.

3. Paste the following code into the code window of Form1:

  Private Declare Function GetSystemMetrics Lib "user32" _
     (ByVal nIndex As Long) As Long

  Const SM_CLEANBOOT&amp; = 67

  Private Sub Command1_Click()
      Dim result As Long
      
      result = GetSystemMetrics(SM_CLEANBOOT)
      
      Select Case result
          Case 0
              MsgBox "System started in normal mode."
          Case 1
              MsgBox "System started in safe mode."
          Case 2
              MsgBox "System started in safe mode with networking."
          Case Else
              MsgBox "Unknown value returned from GetSystemMetrics."
      End Select
  End Sub

4. Click Run, or press the F5 key, to run the project.

5. Click Command1. Notice that a message appears that reflects the startup mode
  of your system.

REFERENCES
==========

For additional information using the API from Visual Basic, click the article
number below to view the article in the Microsoft Knowledge Base:

  Q190000 HOWTO: Get Started Programming with the Windows API (LONG)

The MSDN Platform SDK Help for GetSystemMetrics

The Visual Basic Programmer's Guide

Additional query words: SM_CLEANBOOT boot

======================================================================
Keywords          : kbAPI kbSDKWin32 kbVBp kbVBp500 kbVBp600 kbGrpDSVB kbDSupport 
Technology        : kbVBSearch kbAudDeveloper kbZNotKeyword6 kbZNotKeyword2 kbVB500Search kbVB600Search kbVBA500 kbVBA600 kbVB500 kbVB600
Version           : :5.0,6.0
Issue type        : kbhowto

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>