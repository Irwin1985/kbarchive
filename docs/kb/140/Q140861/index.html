<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q140861: FIX: Default Value Not Evaluated Properly Using Stored Procs | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q140861: FIX: Default Value Not Evaluated Properly Using Stored Procs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/140/Q140861/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/140/Q140861/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q140861: FIX: Default Value Not Evaluated Properly Using Stored Procs","url":"http://jeffpar.github.io/kbarchive/kb/140/Q140861/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q140861-fix-default-value-not-evaluated-properly-using-stored-procs">Q140861: FIX: Default Value Not Evaluated Properly Using Stored Procs</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q140861
Product(s): Microsoft FoxPro
Version(s): WINDOWS:3.0
Operating System(s): 
Keyword(s): kbbuglist kbfixlist
Last Modified: 24-MAR-2000

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Visual FoxPro for Windows, version 3.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

Under specific circumstances where two columns are calculating default values, a
stored procedure may not be executed rapidly enough resulting in default values
being inserted into a table's fields instead of the data generated by the stored
procedure.

CAUSE
=====

If the stored procedure that calculates the default value takes too long, a
default of 0 is used for numeric fields. This is a result of a timing issue, and
not a coding issue.

STATUS
======

Microsoft has confirmed this to be a problem in the Microsoft products listed at
the beginning of this article. This problem was corrected in Visual FoxPro 3.0b
for Windows.

MORE INFORMATION
================

The following code, when run using Visual FoxPro 3.0, demonstrates the behavior
noted in this article. After a few records, the program will fail with one of
several error messages. Using Visual FoxPro 3.0b, this code runs successfully.

Steps to Reproduce Problem
--------------------------

1. Place the following two functions into a program file called Bug.sp:

     FUNCTION spIncr
        PARAMETER cAliasName, cFname
        PRIVATE iNewVal
        lOldDel = SET ("DELETED")
        SET DELETED OFF
        SELECT MAX(&amp;cFname) FROM (cAliasName) INTO ARRAY tmparr
        SET DELETED &amp;lOldDel
        IF (_TALLY = 0)
          RETURN 1
        ENDIF
        iNewVal = tmparr(1) + 1
        RETURN iNewVal
     ENDFUNC

     FUNCTION spDefVal
        PARAMETER cAliasName, cFname, aDefRetVal
        PRIVATE aNewVal
        aNewVal = .NULL.
        ON Error *
        aNewVal = aDefRetVal
        aNewVal = &amp;cAliasName..&amp;cFname
        ON Error
        RETURN aNewVal
     ENDFUNC

2. Execute the following code from a second .prg file:

     SET SAFETY OFF
     CLOSE DATABASE ALL
     CREATE DATABASE 'bugreport.DBC'
     APPEND PROCEDURES FROM 'bug.sp'
     COMPILE DATABASE bugreport.DBC
     CREATE TABLE 'bug' (NR1 I NOT NULL Default spIncr("bug","nr1"), ;
                        NR2 I NOT NULL Default spDefVal("anytable", ;
                        "anyfield",0))
     ALTER TABLE 'bug' ADD PRIMARY KEY NR1 Tag NR1
     INDEX ON NR2 Tag NR2

     USE bug
     BROWSE NOWAIT
     FOR idat = 1 TO 200
        KEYBOARD "{CTRL+Y}" &amp;&amp; Append blank
     NEXT

Additional query words: VFoxWin buglist3.00 fixlist3.00b fail

======================================================================
Keywords          :  kbbuglist kbfixlist
Technology        : kbVFPsearch kbAudDeveloper kbVFP300
Version           : WINDOWS:3.0
Issue type        : kbbug
Solution Type     : kbfix

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>