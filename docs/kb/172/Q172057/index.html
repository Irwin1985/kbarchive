<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q172057: FIX: CreateDragImage Method in ListView Uses Wrong Icon | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q172057: FIX: CreateDragImage Method in ListView Uses Wrong Icon" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/172/Q172057/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/172/Q172057/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q172057: FIX: CreateDragImage Method in ListView Uses Wrong Icon","url":"http://jeffpar.github.io/kbarchive/kb/172/Q172057/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q172057-fix-createdragimage-method-in-listview-uses-wrong-icon">Q172057: FIX: CreateDragImage Method in ListView Uses Wrong Icon</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q172057
Product(s): Microsoft Visual Basic for Windows
Version(s): 
Operating System(s): 
Keyword(s): kbGrpDSVB
Last Modified: 11-JAN-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Visual Basic Professional Edition for Windows, version 5.0 
- Microsoft Visual Basic Enterprise Edition for Windows, version 5.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

When dragging a selection from the ListView control, the icon for the first item
in the list is displayed during the drag operation. This problem occurs when the
CreateDragImage method is used.

RESOLUTION
==========

To work around this problem, it is necessary to extract the correct icon from
the image list that provides the icons for the ListView. For example, if the
original line of code reads:

     ListView1.DragIcon = ListView1.SelectedItem.CreateDragImage

change it to read:

     ListView1.DragIcon= _
     ImageList1.ListImages(ListView1.SelectedItem.Index).ExtractIcon

STATUS
======

Microsoft has confirmed this to be a bug in the Microsoft products listed at the
beginning of this article. This bug has been fixed in Visual Basic 6.0.

MORE INFORMATION
================

Steps to Reproduce Behavior
---------------------------

1. Create a new "Standard EXE" project.

2. On the default form, place an ImageList, a ListView, and a label.

3. Set the View property of the ListView control to "2-lvwList."

4. Place the following code in the Forms module:

     Dim itmX As ListItem

     Private Sub Form_Load()
     Dim i As Integer
     ListView1.Icons = ImageList1
     ListView1.SmallIcons = ImageList1
     For i = 1 To 4
        Set itmX = ListView1.ListItems.Add(i, , "List item " + Str(i), i, i)
     Next
     End Sub

     Private Sub ListView1_MouseDown(Button As Integer, Shift As Integer, _
        x As Single, y As Single)
     Set itmX = ListView1.SelectedItem ' Set the item being dragged.
     End Sub

     Private Sub listView1_MouseMove(Button As Integer, Shift As Integer, _
        x As Single, y As Single)
     If Button = vbLeftButton Then ' Signal a Drag operation.
        Label1.Caption = ListView1.SelectedItem 'Check which item is selected
        ListView1.DragIcon = ListView1.SelectedItem.CreateDragImage
        'workaround
        'ListView1.DragIcon = _
        '  ImageList1.ListImages(ListView1.SelectedItem.Index).ExtractIcon
        ListView1.Drag vbBeginDrag ' Drag operation.
    End If
    End Sub

5. Run the project.

6. Drag a selection from the ListView. Note that the icon used for the drag
  operation is always the first icon in the ListView control.

Additional query words: kbVBp500bug kbVBp600fix kbVBp kbdsd kbDSupport kbControl kbCreate

======================================================================
Keywords          : kbGrpDSVB 
Technology        : kbVBSearch kbAudDeveloper kbZNotKeyword6 kbZNotKeyword2 kbVB500Search kbVBA500 kbVB500
Issue type        : kbbug
Solution Type     : kbfix

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>