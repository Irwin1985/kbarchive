<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q163396: PRB: Creating Regular Indexes Through VFP ODBC Driver | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q163396: PRB: Creating Regular Indexes Through VFP ODBC Driver" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/163/Q163396/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/163/Q163396/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q163396: PRB: Creating Regular Indexes Through VFP ODBC Driver","url":"http://jeffpar.github.io/kbarchive/kb/163/Q163396/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q163396-prb-creating-regular-indexes-through-vfp-odbc-driver">Q163396: PRB: Creating Regular Indexes Through VFP ODBC Driver</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q163396
Product(s): Microsoft FoxPro
Version(s): 5.0
Operating System(s): 
Keyword(s): kbODBC kbvfp
Last Modified: 01-NOV-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Visual FoxPro for Windows, version 5.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

Currently, it is not possible to create a regular index with the INDEX ON
command on a table through the Visual FoxPro ODBC driver, either by SQL Pass
Through or a Default Value, Rule, or Trigger code.

RESOLUTION
==========

It is possible to create a Regular index indirectly with the ALTER TABLE or
CREATE TABLE commands.

NOTE: Please use steps 1-6 from the MORE INFORMATION section below prior to using
the following examples.

Example 1
---------

This example creates a Regular index on a table when the table is created. A
problem you might encounter is that the SQLEXEC() function returns a &lt; 0
result indicating that it failed (and it did fail to carry out the exact command
it was passed). The command passed tries to create a Persistent Relationship to
itself and Visual FoxPro completed a portion of the process before it realized
it could not complete the entire operation. The byproduct of the command failing
is the index tag. The drawback with this method is there is no positive means of
determining whether the tag was actually created:

        mchnl=SQLCONNECT('vfp') &amp;&amp; Connect to datasouce
        ? mchnl &amp;&amp; Needs to return a value &gt; 0
        ? SQLEXEC(mchnl,'CREATE TABLE x6 (col1 c(1), col2 c(3), ;
            FOREIGN KEY col2 TAG col2 REFERENCES x6)')
        ? AERROR(temp)
        DISPLAY MEMORY temp
        ? SQLDISCONNECT(mchnl)

Example 2
---------

This example creates a regular index on an existing table. It functions on the
same principles as Example 1 and has the same drawbacks:

        mchnl=SQLCONNECT('vfp') &amp;&amp; Connect to datasouce
        ? mchnl &amp;&amp; Needs to return a value &gt; 0
        ? SQLEXEC(mchnl,'CREATE TABLE x1 (col1 c(1), col2 c(3))')
        ? SQLEXEC(mchnl,'ALTER TABLE x1 ;
        ADD FOREIGN KEY col2 TAG col2 REFERENCES x1')

Example 3
---------

This is probably the best method because you can be confident that the Index was
not created if the SQL Pass Through command returns a &lt; 0 number. This
example requires a Primary Key to exist for the same reasons that Examples 1 and
2 SQL Pass Through commands failed. The SQL Pass Through command being passed is
going to establish a Persistent Relationship and then DROP the FOREIGN KEY with
the SAVE clause. This will destroy the Persistent Relationship but will preserve
the Regular index TAG:

        mchnl=SQLCONNECT('vfp') &amp;&amp; Connect to datasource
        ? mchnl &amp;&amp; Needs to return a value &gt; 0
        ? SQLEXEC(mchnl,'CREATE TABLE x2 (col1 c(1) PRIMARY KEY col2 c(3))')
        ? SQLEXEC(mchnl,'ALTER TABLE x2 ;
            ADD FOREIGN KEY col2 TAG col2 REFERENCES x2')
        ? SQLEXEC(mchnl,'ALTER TABLE x2 DROP FOREIGN KEY TAG col2 SAVE')

STATUS
======

This behavior is by design.

MORE INFORMATION
================

Using the INDEX ON command through the Visual FoxPro ODBC driver will generate
either a syntax error or a "Trigger Failed" error.

Steps to Reproduce Behavior
---------------------------

1. Start the ODBC Driver Manager or ODBC Data Source Administrator.

2. Create a New Datasource using the Visual FoxPro Database Driver.

3. Give the Datasource the name of "VFP."

4. For Database Type, choose Visual FoxPro Database(.DBC).

5. For the Path of the Database, use the BROWSE button and point to
  SAMPLES\DATA\testdata.dbc in the Visual FoxPro directory.

6. Start Visual FoxPro.

7. Issue a MODIFY DATABASE ? command, and then select the
  SAMPLES\DATA\Testdata.dbc.

8. From the Database Menu, select Edit Stored Procedures.

9. Place the following code in the Stored Procedures:

        PROCEDURE cmdins
        USE customer IN 0 EXCLUSIVE
        SELECT customer
        INDEX ON contact TAG contact
        RETURN .T.

10. Save and the changes made to the Stored Procedures and then choose Close.

11. Select the Customer Table.

12. Right-click the Customer Table to bring up the Shortcut menu.

13. Choose Modify.

14. In the MODIFY STRUCTURE dialog box for the Customer table, select the TABLE
  Tab.

15. For the INSERT Trigger, enter "cmdins()" (the stored procedure above).

16. Save everything and issue a CLOSE ALL to close the database and table.

17. Issue the following commands from the Command Window:

        mchnl=SQLCONNECT('vfp') &amp;&amp; Use the datasource defined above.
        ? mchnl &amp;&amp; Ensure that a value greater than zero is returned.
        ? SQLEXEC(mchnl,"INSERT INTO customer ;
            (cust_id, company, contact, title, address, city, region, ;
            postalcode, country, phone, fax, maxordamt) ;
            VALUES ('31111', 'one', 'one', 'one', 'one', 'one', 'one', ;
            'one', 'one', 'one', 'one', 1)")
        * The above command invokes the Insert Trigger which fails.
        ? AERROR(temp) &amp;&amp; Use AERROR() to get the last error
        DISPLAY MEMORY LIKE temp
        * Note it returns the "Trigger Failed" error

Additional query words: 1.00 5.00

======================================================================
Keywords          : kbODBC kbvfp 
Technology        : kbVFPsearch kbAudDeveloper kbVFP500
Version           : :5.0
Issue type        : kbprb

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>