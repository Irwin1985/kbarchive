<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q57851: CALL INTERRUPT for Small Time Increments Using BIOS Tick Count | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q57851: CALL INTERRUPT for Small Time Increments Using BIOS Tick Count" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/057/Q57851/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/057/Q57851/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q57851: CALL INTERRUPT for Small Time Increments Using BIOS Tick Count","url":"http://jeffpar.github.io/kbarchive/kb/057/Q57851/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q57851-call-interrupt-for-small-time-increments-using-bios-tick-count">Q57851: CALL INTERRUPT for Small Time Increments Using BIOS Tick Count</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q57851
Product(s): See article
Version(s): 4.00 4.00b 4.50
Operating System(s): MS-DOS
Keyword(s): ENDUSER | SR# S900111-209 B_BasicCom | mspl13_basic
Last Modified: 25-OCT-1990

The TIME$ function in BASIC returns the current time in hours,
minutes, and seconds from DOS or OS/2, but it cannot return any
increments smaller than one second.

However, a program can use the INTERRUPT routine to call the IBM ROM
BIOS interrupt 1A Hex (26 decimal) with function 0. This function
returns the number of system timer ticks since midnight. The number of
timer ticks can then be used to calculate the number of seconds that
have passed since midnight. You can then time to a resolution of
18.20648 ticks per second (or .05492549 of a second).

This information applies to Microsoft QuickBASIC versions 2.00, 3.00,
4.00, 4.00B, and 4.50, to Microsoft BASIC Compiler versions 6.00 and
6.00b for MS-DOS, and to Microsoft BASIC Professional Development
System (PDS) versions 7.00 and 7.10 for MS-DOS.

Here are three separate methods to get a small time interval:

1. Use BIOS INTERRUPT 15 Hex, with function 86 hex (or, in decimal,
   INTERRUPT 21 with function 134) for a resolution at intervals of
   976 microseconds (976 millionths, or .000976 of a second).

2. Use BIOS INTERRUPT 1A hex (26 decimal) with function 0 for a
   resolution at about 18.20648 ticks per second (or .05492549
   seconds).

3. Use the ON PLAY statement for resolution at 30 times per second
   (or .0333333).

This article describes method 2 above. To find two other articles,
which explain methods 1 and 3, search in this Knowledge Base using the
following exact words:

   BASIC and timer and increments and smaller and second

Explanation of PC Timer Ticks
-----------------------------

Below is an explanation of how the PC system timer works. Also
included is a BASIC program example that shows how to calculate the
number of seconds since midnight to the hundredths place, with a
resolution of .05492549 of a second.

A timer "tick" is an interrupt that is generated by the PC's system
timer. When this interrupt occurs, the ROM BIOS interrupt handler is
called, and it increments a count in the ROM BIOS data area reserved
for recording the number of ticks since midnight.

Timer ticks work as follows. More than one system timer tick occurs
per second. In fact, a timer tick occurs approximately 18.2 times
every second. To be even more exact, a timer tick occurs every
1,193,180 / 65,536 times per second, which is 18.20648 times per
second. The first value, 1,193,180, represents the frequency at which
the PC system timer operates, which is 1.193 MHz. This means that the
system timer can actually recognize increments as small as 1 /
1,193,180 seconds.

However, since very few programs could possibly need a time increment
this small, the system timer uses another method to determine when to
generate a tick. The system timer maintains an internal register. The
timer initializes the register to 65,535 and then decrements the
register or "counts down" from 65,535 to zero. When zero occurs, the
timer generates a tick (it actually generates an interrupt that
increments the tick count). Note that this is where the lower half of
the fraction 1,193,180 / 65,536 comes from. If the timer runs at 1.93
MHz and it decrements a counter 65,536 times before it generates a
tick, this means that dividing the timer speed by this countdown value
gives us how many ticks occur per second.

For more information on the PC system timer, please refer to Page 145
of "The New Peter Norton Programmer's Guide to the IBM PC &amp; PS/2"
(Microsoft Press, 1988).

The following program example shows how to use the tick count returned
by interrupt &amp;H1A function 0 to calculate the number of seconds since
midnight to the hundredth place. To run this program in the QB.EXE
editor, you must load the program with /L to load the QB.QLB Quick
library (but for BASIC PDS 7.00 or 7.10, use QBX /L to load QBX.QLB).
If you compile from the command line, you must link in the QB.LIB
library (or the QBX.LIB library for BASIC PDS 7.00).

Code Example
------------

REM   TIMEINT.BAS
DEFLNG A-Z
' $INCLUDE: 'QB.BI'
' For BASIC PDS 7.00 you must change above line to QBX.BI
CONST tps = 18.2064819336# ' tps is ticks per second
DIM inregs AS RegType, outregs AS RegType
DIM flag AS INTEGER, Previous AS LONG
CLS
LOCATE 1, 20: PRINT "Hit any key to end"
WHILE INKEY$ = ""
        inregs.ax = 0
        CALL INTERRUPT(&amp;H1A, inregs, outregs)
        ' CX should never be larger than &amp;H0017, so direct
        ' assignment is possible.
        ticks&amp; = outregs.cx * &amp;H10000
        ' The following IF accounts for the fact that the
        ' interrupt is using an unsigned int (register) but BASIC
        ' has only signed integers. Special action must be taken
        ' for numbers that appear to be negative.
        IF outregs.dx &lt; 0 THEN
                a2&amp; = (outregs.dx AND &amp;H7FFF&amp;)
                ticks&amp; = (ticks&amp; + a2&amp;)
                ticks&amp; = (ticks&amp; OR &amp;H8000&amp;)
        ELSE
                ticks&amp; = ticks&amp; + outregs.dx
        END IF
        IF Previous &gt; ticks&amp; THEN BEEP ' It's midnight!
        Previous = ticks&amp;

        Previous = ticks&amp;
        seconds# = ticks&amp; / tps 'ticks per second

        LOCATE 10, 10
        PRINT "Clock ticks since midnight: ";
        PRINT ticks&amp;
        LOCATE 11, 10
        PRINT "Seconds since midnight: ";
        PRINT USING "######.##"; seconds#
WEND
END
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>