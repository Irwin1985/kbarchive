<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q182532: HOWTO: DMA-Capable ATAPI Device Driver for Windows NT | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q182532: HOWTO: DMA-Capable ATAPI Device Driver for Windows NT" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/182/Q182532/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/182/Q182532/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q182532: HOWTO: DMA-Capable ATAPI Device Driver for Windows NT","url":"http://jeffpar.github.io/kbarchive/kb/182/Q182532/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q182532-howto-dma-capable-atapi-device-driver-for-windows-nt">Q182532: HOWTO: DMA-Capable ATAPI Device Driver for Windows NT</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q182532
Product(s): Microsoft Windows NT
Version(s): winnt:4.0
Operating System(s): 
Keyword(s): 
Last Modified: 09-AUG-2001

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft Windows NT Workstation version 4.0 
-------------------------------------------------------------------------------

SUMMARY
=======

Windows NT Service Pack 2 includes a new Windows NT device driver for direct
memory access (DMA)-capable ATAPI devices. Using this new driver in Windows NT
improves CPU utilization over standard PIO, increasing system usability while
IDE operations are in progress.

MORE INFORMATION
================

Using PCI bus master DMA, the CPU has to service only a single interrupt that is
generated when the IDE command completes. This is compared to standard PIO,
where the CPU has to service an interrupt from the device, every time a block of
data becomes available to the host. Performance figures on a checked build
showed approximately 20 to 30 percent CPU utilization using DMA, versus
approximately 90 to 100 percent utilization during PIO transfers. Performance
figures for DMA on a free build are even better, showing single-digit
percentages in some cases.

DMA Requirements
----------------

Registry keys must be added to enable direct memory access (DMA). The levels of
DMA support include DMA detection level zero (disabled; this is the default) and
DMA detection level one. The following criteria must be met before the driver
will allow support for DMA detection level one:

- PCI command register bit two (Master Enable) is set.

- PCI device Class code is one.

- PCI device Subclass code is one.

- Programmer's interface bit seven is set.

- Busmaster status register bits five and six are set. Bit 5 is set for the
  master and bit 6 is set for the slave if the device exists. These bits should
  be set by the BIOS, but many system BIOSs currently do not do this.

Determining DMA Status
----------------------

Whether DMA is enabled can be determined by looking in the registry under:

HKEY_LOCAL_MACHINE\HARDWARE\DEVICEMAP\Scsi\ScsiPort x

  (where x represents the IDE channel; zero is the primary channel, one is the
  secondary channel).

Notice that the initiator ID is always 255 on IDE/ATAPI channels. There will be a
DWORD value named DMAEnabled that will be set to zero if DMA is not active, and
one, if DMA is active.

Enabling DMA Detection Level 1
------------------------------

The ATAPI driver can be set to enable DMA use on a per-channel basis. Under the
current SCSIPORT model, it is not possible to use DMA on one device and PIO on
another if the devices are on the same channel.

Enabling DMA use can be done by adding the following keys under:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\atapi:
\Parameters\DeviceX\ (where X represents the IDE channel)

NOTE: The above registry key is one path; it has been wrapped for readability.

When the keys have been created, you must create a DriverParameter STRING value
and set it to DMADetectionLevel = 0x1.

Disabling DMA Detection Level Zero
----------------------------------

The ATAPI driver can be set to disable DMA use on a per-channel basis. This can
be done by adding the following keys under:

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\atapi:
\Parameters\DeviceX\ (where X represents the IDE channel)

NOTE: The above registry key is one path; it has been wrapped for readability.

When you create the keys, you must also create a DriverParameter STRING value and
set it to DMADetectionLevel = 0x0.

Additional query words: DMA ATAPI IDE

======================================================================
Keywords          :  
Technology        : kbWinNTsearch kbWinNTWsearch kbWinNTW400 kbWinNTW400search kbWinNT400search
Version           : winnt:4.0
Issue type        : kbhowto

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>