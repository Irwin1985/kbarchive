<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q141277: HOWTO: Override an Interface in an MFC Application | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q141277: HOWTO: Override an Interface in an MFC Application" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/141/Q141277/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/141/Q141277/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q141277: HOWTO: Override an Interface in an MFC Application","url":"http://jeffpar.github.io/kbarchive/kb/141/Q141277/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q141277-howto-override-an-interface-in-an-mfc-application">Q141277: HOWTO: Override an Interface in an MFC Application</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q141277
Product(s): Microsoft C Compiler
Version(s): 2.0,2.1,2.2,4.0,5.0,6.0
Operating System(s): 
Keyword(s): kbole kbActiveX kbCOMt kbCtrl kbMFC kbVC200 kbVC400 kbVC500 kbVC600 kbGrpDSMFCATL kbArc
Last Modified: 29-APR-2002

-------------------------------------------------------------------------------
The information in this article applies to:

- The Microsoft Foundation Classes (MFC), used with:
   - Microsoft Visual C++, 32-bit Editions, versions 2.0, 2.1, 2.2, 4.0 
   - Microsoft Visual C++, 32-bit Enterprise Edition, versions 5.0, 6.0 
   - Microsoft Visual C++, 32-bit Professional Edition, versions 5.0, 6.0 
   - Microsoft Visual C++, 32-bit Learning Edition, version 6.0 
   - Microsoft Visual C++.NET (2002) 
-------------------------------------------------------------------------------

NOTE: Microsoft Visual C++ NET (2002) supported both the managed code model that is provided by the .NET Framework and the unmanaged native Windows code model. The information in this article applies to unmanaged Visual C++ code only.

SUMMARY
=======

In an MFC application, you can override existing interfaces in a class as well
as provide additional interfaces. Overriding an interface in this case is
synonymous with replacing an interface. The example in this article illustrates
how to override an interface in a class while preserving the original interface
implementation so that it can be delegated to by the new interface
implementation.

This article doesn't deal with overriding the IDispatch implementation as this is
a special case. The following article demonstrates how to override IDispatch in
MFC:

  Q140616 MFCDISP: Replacing MFC's IDispatch implementation


MORE INFORMATION
================

The following steps will override the IOleObject implementation for a default
OLE Control generated by the Control Wizard.

1. To add the declaration of the IOleObject implementation to the control, add
  the following code to the header file for the COleControl-derived class:

        // Interface Maps
        protected:
             // IOleObject
             BEGIN_INTERFACE_PART(MyOleObject, IOleObject)
                 INIT_INTERFACE_PART(CIOleOverCtrl, MyOleObject)
                 STDMETHOD(SetClientSite)(LPOLECLIENTSITE);
                 STDMETHOD(GetClientSite)(LPOLECLIENTSITE*);
                 STDMETHOD(SetHostNames)(LPCOLESTR, LPCOLESTR);
                 STDMETHOD(Close)(DWORD);
                 STDMETHOD(SetMoniker)(DWORD, LPMONIKER);
                 STDMETHOD(GetMoniker)(DWORD, DWORD, LPMONIKER*);
                 STDMETHOD(InitFromData)(LPDATAOBJECT, BOOL, DWORD);
                 STDMETHOD(GetClipboardData)(DWORD, LPDATAOBJECT*);
                 STDMETHOD(DoVerb)(LONG, LPMSG, LPOLECLIENTSITE, LONG, HWND,
                         LPCRECT);
                 STDMETHOD(EnumVerbs)(IEnumOLEVERB**);
                 STDMETHOD(Update)();
                 STDMETHOD(IsUpToDate)();
                 STDMETHOD(GetUserClassID)(CLSID*);
                 STDMETHOD(GetUserType)(DWORD, LPOLESTR*);
                 STDMETHOD(SetExtent)(DWORD, LPSIZEL);
                 STDMETHOD(GetExtent)(DWORD, LPSIZEL);
                 STDMETHOD(Advise)(LPADVISESINK, LPDWORD);
                 STDMETHOD(Unadvise)(DWORD);
                 STDMETHOD(EnumAdvise)(LPENUMSTATDATA*);
                 STDMETHOD(GetMiscStatus)(DWORD, LPDWORD);
                 STDMETHOD(SetColorScheme)(LPLOGPALETTE);
             END_INTERFACE_PART(MyOleObject)

        DECLARE_INTERFACE_MAP();

  This adds a nested class XMyOleObject to your control class. Note that these
  macros declare interface methods including the IUnknown interface methods, so
  you must implement the IUnknown methods as well.

2. Add the IOleObject interface to the interface map for the control by adding
  an INTERFACE_PART macro to the implementation file for the control:

        BEGIN_INTERFACE_MAP(CIOleOverCtrl, COleControl)
           INTERFACE_PART(CIOleOverCtrl, IID_IOleObject, MyOleObject)
        END_INTERFACE_MAP()

  Replace CIOleOverCtrl with the name of your control and MyOleObject with the
  name you chose for the nested class that supports IOleObject.

3. Implement the interface methods you declared. Add the following code to the
  implementation file for the control:

        STDMETHODIMP_(ULONG) CIOleOverCtrl::XMyOleObject::AddRef()
        {
            METHOD_MANAGE_STATE(CIOleOverCtrl, MyOleObject)
            ASSERT_VALID(pThis);

            return pThis-&gt;m_xOleObject.AddRef();
        }

        STDMETHODIMP_(ULONG) CIOleOverCtrl::XMyOleObject::Release()
        {
            METHOD_MANAGE_STATE(CIOleOverCtrl, MyOleObject)
            ASSERT_VALID(pThis);

            return pThis-&gt;m_xOleObject.Release ();
        }

        STDMETHODIMP CIOleOverCtrl::XMyOleObject::QueryInterface(
            REFIID iid, LPVOID far* ppvObj)
        {
            METHOD_MANAGE_STATE(CIOleOverCtrl, MyOleObject)
            ASSERT_VALID(pThis);

            return pThis-&gt;m_xOleObject.QueryInterface ( iid,  ppvObj);
        }

        STDMETHODIMP
        CIOleOverCtrl::XMyOleObject::SetClientSite(LPOLECLIENTSITE
        pClientSite)
        {
            METHOD_MANAGE_STATE(CIOleOverCtrl, MyOleObject)
               ASSERT_VALID(pThis);

            return pThis-&gt;m_xOleObject.SetClientSite ( pClientSite );
        }
        ...

The rest of the methods follow the same pattern where CIOleOverCtrl is the name
of the control, XMyOleObject is the name of the nested class that supports
IOleObject, and m_xMyOleObject is calculated by removing the I from the
interface being supported and adding m_x.

Note that these methods simply pass the call on to the original IOleObject
implementation. However, this is not a requirement; you could add functionality
and delegate to the original implementation or not delegate at all.

REFERENCES
==========

Technical Notes #38 and #39.

Additional query words:

======================================================================
Keywords          : kbole kbActiveX kbCOMt kbCtrl kbMFC kbVC200 kbVC400 kbVC500 kbVC600 kbGrpDSMFCATL kbArchitecture 
Technology        : kbAudDeveloper kbMFC
Version           : :2.0,2.1,2.2,4.0,5.0,6.0
Issue type        : kbhowto

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>