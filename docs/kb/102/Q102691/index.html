<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/kbarchive/assets/css/style.css?v=d2057ae472d963fbdcbf65805f43123bccb709dc">
    <link rel="stylesheet" type="text/css" href="/kbarchive/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Q102691: PRB: LNK2133 Size Mismatch on Common Block During Link | KnowledgeBase Archive</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Q102691: PRB: LNK2133 Size Mismatch on Common Block During Link" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<meta property="og:description" content="An Archive of Early Microsoft KnowledgeBase Articles" />
<link rel="canonical" href="http://jeffpar.github.io/kbarchive/kb/102/Q102691/" />
<meta property="og:url" content="http://jeffpar.github.io/kbarchive/kb/102/Q102691/" />
<meta property="og:site_name" content="KnowledgeBase Archive" />
<script type="application/ld+json">
{"headline":"Q102691: PRB: LNK2133 Size Mismatch on Common Block During Link","url":"http://jeffpar.github.io/kbarchive/kb/102/Q102691/","description":"An Archive of Early Microsoft KnowledgeBase Articles","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
<div id="container">
    <div class="inner">

        <header>
            <h1><a href="/kbarchive">KnowledgeBase Archive</a></h1>
            <h2>An Archive of Early Microsoft KnowledgeBase Articles</h2>
        </header>
        <section id="downloads" class="clearfix">
            
            
            <a href="https://github.com/jeffpar/kbarchive" id="view-on-github" class="button"><span>View on GitHub</span></a>
            
        </section>
        <hr>
        <section id="main_content">
                <div>
        <h2 id="q102691-prb-lnk2133-size-mismatch-on-common-block-during-link">Q102691: PRB: LNK2133 Size Mismatch on Common Block During Link</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Article: Q102691
Product(s): Microsoft Fortran Compiler
Version(s): 1.0
Operating System(s): 
Keyword(s): 
Last Modified: 06-NOV-1999

-------------------------------------------------------------------------------
The information in this article applies to:

- Microsoft FORTRAN PowerStation for MS-DOS, version 1.0 
-------------------------------------------------------------------------------

SYMPTOMS
========

An attempt to link code that contains a COMMON block fails and the linker
generates the following message:

  error LNK2133: Size mismatch for symbol &lt;_XXXX&gt;

where &lt;_XXXX&gt; is the name of the COMMON block.

CAUSE
=====

The source code declares an initialized COMMON block with one size in one
routine and an uninitialized COMMON block with the same name but with another
size in another routine.

RESOLUTION
==========

The best method to resolve this situation involves modifying the source code
such that each declaration of the COMMON block has the same size. If this is not
possible, modify the LINK command line to list the object module that contains
the initialized COMMON block declaration before the other modules. In addition,
the initialized COMMON block declaration must be as large or larger than any
subsequent COMMON block declaration or memory corruption or other incorrect
results may occur.

STATUS
======

These problems do not occur with FORTRAN PowerStation 1.0a.

MORE INFORMATION
================

The Common Object File Format (COFF) implements COMMON blocks using two record
types: COMDAT and COMDEF. A COMDAT record contains initialized COMMON block data
and a COMDEF record contains uninitialized COMMON block data. LINK32 resolves
each reference to the COMMON block by associating each COMDEF record with the
first COMDAT record it encounters, if any. The first COMDAT record determines
the amount of space reserved for the COMMON data storage; if no COMDAT record
exists, the largest COMDEF record determines the amount of space reserved. This
behavior has the following implications:

  If the data in a COMMON block is not initialized in any routine, COMMON block
  declarations with different sizes should not cause any problems and you can
  link the object files with the varying declarations in any order. Each
  declaration must be in a separate source file or the FORTRAN compiler
  generates an error.

  The application should initialize the COMMON block in only one location.
  LINK32 ignores subsequent COMDAT records and does not adjust the amount of
  storage set aside for the COMMON block. If the first COMDAT record in the
  file is smaller than subsequent COMDAT records, LINK32 does not generate an
  error message. However, when you run the application it could corrupt memory.
  Generating debugging information with the /4Yb compiler option switch does
  not catch this condition because each array in a COMMON block is correctly
  dimensioned in each object module.

  If LINK32 encounters a COMDEF record before a COMDAT record, the size of the
  COMDEF record must agree with the size of the COMDAT record. Otherwise,
  LINK32 generates the LNK2133 error and the link fails.

To demonstrate this error, perform the following four steps:

1. Compile each of the code examples below.

2. Link Sample 1 with Sample 2 or Sample 3. No error occurs at link time but a
  DX1020 error occurs at run time.

3. Link Sample 2 with Sample 1. The link fails and an LNK2133 error occurs.

4. Link Sample 3 with Sample 1. No errors occur at link time or at run time.
  LINK32 ignores the data statement in Sample 1.

Sample Code 1
-------------

  C Compiler options needed: /c
        program tester
        integer arr
        common /testblk/ arr(1)
        data arr /11/ 
        call sub1
        print*, arr(1000000)
        end

Sample Code 2
-------------

  C Compiler options needed: /c
        subroutine sub1
        integer arr
        common /testblk/ arr(1000000)
        arr(1000000) = 99
        end

Sample Code 3
-------------

  C Compile options needed: /c
        subroutine sub1
        integer arr
        common /testblk/ arr(1000000)
        data arr /1000000*77/ 
        arr(1000000) = 99
        end

Additional query words: 1.00

======================================================================
Keywords          :  
Technology        : kbAudDeveloper kbFortranSearch kbZNotKeyword3 kbFORTRANPower100DOS
Version           : :1.0

=============================================================================
</code></pre></div></div>


        <p>
            THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
            PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
            ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
            OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
            EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
            ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
            CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
            MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
            POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
            OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
            SO THE FOREGOING LIMITATION MAY NOT APPLY.
        </p>
        <p>Copyright Microsoft Corporation 1986-2002.</p>
    </div>

        </section>

        <footer>
            
            KnowledgeBase Archive is maintained by <a href="https://www.pcjs.org">PCjs</a>.<br>
            
            This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

    </div>
</div>


<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49658648-3', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>